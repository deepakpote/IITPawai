/*
 * ngComboDatePicker v1.4.1
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){function maxDate(e,t){var a=31;return null!=e&&((4==e||6==e||9==e||11==e)&&(a=30),null!=t&&2==e&&(a=t%4==0&&t%100!=0||t%400==0?29:28)),a}function adjustTimezone(e,t){var a=isNaN(t)?(new Date).getTimezoneOffset():60*parseFloat(t);return new Date(e.getTime()+60*a*1e3)}function parseDate(e,t){var a=null;return void 0!==e&&null!==e&&(e instanceof Date?a=e:("number"==typeof e||"string"==typeof e)&&(a=new Date(isNaN(e)?e:parseInt(e,10)),a=adjustTimezone(a,t))),a}function parseIntStrict(e){return null!==e&&""!==e&&parseInt(e)!=0/0?parseInt(e):null}function parseJsonPlus(e){var t=null;if(null!=e){try{t=JSON.parse(e)}catch(a){}if(null==t)try{t=JSON.parse(e.replace(/'/g,'"'))}catch(a){}}return t}return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@",ngDisabled:"=",ngYearOrder:"@",ngTimezone:"@",ngPlaceholder:"@",ngPlaceholderEnabled:"@",ngRequired:"@"},require:"ngModel",controller:["$scope",function(e){e.ngModel=parseDate(e.ngModel,e.ngTimezone),e.ngAttrsDate=parseJsonPlus(e.ngAttrsDate),e.ngAttrsMonth=parseJsonPlus(e.ngAttrsMonth),e.ngAttrsYear=parseJsonPlus(e.ngAttrsYear);var t=parseDate(e.ngDate,e.ngTimezone);if(null!=t&&(e.ngModel=t),e.ngOrder="string"!=typeof e.ngOrder?"dmy":e.ngOrder.toLowerCase(),e.minDate=parseDate(e.ngMinDate,e.ngTimezone),null==e.minDate){var a=new Date;e.minDate=new Date(a.getFullYear()-100,a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}if(e.maxDate=parseDate(e.ngMaxDate,e.ngTimezone),null==e.maxDate&&(e.maxDate=new Date),e.ngModel<e.minDate&&(e.ngModel=e.minDate),e.ngModel>e.maxDate&&(e.ngModel=e.maxDate),e.placeHolders=null,void 0!==e.ngPlaceholder&&null!==e.ngPlaceholder&&("string"==typeof e.ngPlaceholder||Array.isArray(e.ngPlaceholder))){var n="string"==typeof e.ngPlaceholder?e.ngPlaceholder.split(","):e.ngPlaceholder;if(3==n.length){e.placeHolders=[];for(var r=0;r<n.length;r++)e.placeHolders.push({value:"",name:n[r],disabled:!1})}}e.years=[];for(var l=e.minDate.getFullYear();l<=e.maxDate.getFullYear();l++)e.years.push({value:l,name:l});"string"==typeof e.ngYearOrder&&0==e.ngYearOrder.indexOf("des")&&e.years.reverse(),e.placeHolders&&e.years.unshift(e.placeHolders[0]);var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==e.ngMonths&&null!==e.ngMonths){if("string"==typeof e.ngMonths){var o=e.ngMonths.split(",");12==o.length&&(s=o)}Array.isArray(e.ngMonths)&&12==e.ngMonths.length&&(s=e.ngMonths)}e.updateMonthList=function(t){t=parseIntStrict(t);var a=null!==t&&t==e.minDate.getFullYear()?e.minDate.getMonth():0,n=null!==t&&t==e.maxDate.getFullYear()?e.maxDate.getMonth():11;e.months=[],e.placeHolders&&e.months.push(e.placeHolders[1]);for(var r=a;n>=r;r++)e.months.push({value:r,name:s[r]})},e.updateDateList=function(t,a){t=parseIntStrict(t),a=parseIntStrict(a);var n=1;null!==t&&t==e.minDate.getMonth()&&null!==a&&a==e.minDate.getFullYear()&&(n=e.minDate.getDate());var r=maxDate(null!==t?t+1:null,a);null!==t&&t==e.maxDate.getMonth()&&null!==a&&a==e.maxDate.getFullYear()&&(r=e.maxDate.getDate()),e.dates=[],e.placeHolders&&e.dates.push(e.placeHolders[2]);for(var l=n;r>=l;l++)e.dates.push({value:l,name:l})}}],link:function(e,t,a,n){for(var r=angular.element,l=r(t[0]).children(),s=e.ngOrder.split(""),o=0;o<s.length;o++)"d"==s[o]&&r(t[0]).append(l[0]),"m"==s[o]&&r(t[0]).append(l[1]),"y"==s[o]&&r(t[0]).append(l[2]);n.$formatters.push(function(t){var a={date:null,month:null,year:null};return t?(a.date=t.getDate(),a.month=t.getMonth(),a.year=t.getFullYear()):(a.date="",a.month="",a.year="",e.placeHolders&&(e.placeHolders[0].disabled=!1,e.placeHolders[1].disabled=!1,e.placeHolders[2].disabled=!1)),e.updateMonthList(a.year),e.updateDateList(a.month,a.year),a}),n.$render=function(){e.date=n.$viewValue.date,e.month=n.$viewValue.month,e.year=n.$viewValue.year},e.$watch('date + "-" + month + "-" + year',function(t,a){t!=a&&n.$setViewValue({date:e.date,month:e.month,year:e.year})}),n.$isEmpty=function(e){return null==e.date||""==e.date||isNaN(parseInt(e.month))||null==e.year||""==e.year},n.$parsers.push(function(t){var a=null;if(null!=t.date&&""!=t.date&&!isNaN(parseInt(t.month))&&null!=t.year&&""!=t.year){var n=maxDate(t.month+1,t.year),r=0,l=0,s=0,o=0;null!=e.ngModel&&(r=e.ngModel.getHours(),l=e.ngModel.getMinutes(),s=e.ngModel.getSeconds(),o=e.ngModel.getMilliseconds()),a=new Date(t.year,t.month,t.date>n?n:t.date,r,l,s,o)}return e.placeHolders&&angular.isUndefined(e.ngPlaceholderEnabled)&&(""!=e.year&&(e.placeHolders[0].disabled=!0),""!=e.month&&(e.placeHolders[1].disabled=!0),""!=e.date&&(e.placeHolders[2].disabled=!0)),e.updateMonthList(t.year),e.updateDateList(t.month,t.year),a}),e.touched=function(){n.$touched=!0,n.$untouched=!1}},template:function(element,attrs){for(var strAttrs=["","",""],attrNames=["ngAttrsDate","ngAttrsMonth","ngAttrsYear"],i=0;3>i;i++)try{if(attrs&&attrs[attrNames[i]]){eval("var attrsAux= "+attrs[attrNames[i]]);for(var key in attrsAux){var value=attrsAux[key];"boolean"==typeof value?value&&(strAttrs[i]+=key+" "):("string"==typeof value&&value.indexOf('"')>0&&(value=value.replace(/"/g,"&quot;")),strAttrs[i]+=key+'="'+value+'" ')}}}catch(err){console.log(err)}var html='<select ng-disabled="ngDisabled === true || ngDisabled[0] === true" ng-model="date" ng-blur="touched()" '+strAttrs[0]+' ng-options="date.value as date.name disable when date.disabled for date in dates"></select><select ng-disabled="ngDisabled === true || ngDisabled[1] === true" ng-model="month" ng-blur="touched()" '+strAttrs[1]+' ng-options="month.value as month.name disable when month.disabled for month in months"></select><select ng-disabled="ngDisabled === true || ngDisabled[2] === true" ng-model="year" ng-blur="touched()" '+strAttrs[2]+' ng-options="year.value as year.name disable when year.disabled for year in years"></select>';return html}}});